<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'sha256-misOqHLBt3vfqlVEeWwQ/xebDpGU92qX8W7XgbaOXOU='; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data:; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self';" />
  <title>Cockroach Run - A Cyberpunk Adventure</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;family=Exo+2:wght@400;600;700&amp;display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components/forms.css" />
  <link rel="stylesheet" href="css/components/character-fixes.css" />
  <link rel="stylesheet" href="css/components/carouselStyle.css" />
  <link rel="stylesheet" href="css/components/settings-fix.css" />
  <link rel="stylesheet" href="css/components/loadingFix.css" />
  <link rel="stylesheet" href="css/components/titleFix.css" />
  <link rel="stylesheet" href="css/components/characters.css" />
  <link rel="stylesheet" href="css/components/menuFixes.css" />
  <link rel="stylesheet" href="css/components/music-controls.css" />
  <link rel="stylesheet" href="css/components/buttonFix.css" />
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <!-- Preload character images -->
  <link rel="preload" href="assets/images/characters/german_cockroach.png" as="image" />
  <link rel="preload" href="assets/images/characters/American Cockroach with bg.png" as="image" />
  <link rel="preload" href="assets/images/characters/Oreintal Cockroach.png" as="image" />
</head>
<body>
  <!-- Game Canvas Container -->
  <div id="game-container">
    <canvas id="game-canvas"></canvas>
  </div>

  <!-- UI Container -->
  <div id="ui-container">
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
      <div class="loading-content">
        <div class="logo-container">
          <img src="assets/images/ui/logo_title.png" alt="Cockroach Run" class="game-logo" />
        </div>

        <div class="loading-title">SYSTEM LOADING</div>

        <div class="progress-container">
          <div class="progress-bar"></div>
        </div>

        <p class="loading-text">Loading... <span id="loading-percent">0</span>%</p>
        <p class="flavor-text">Initializing survival protocols...</p>
      </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen">
      <div class="menu-container">
        <div class="logo-container">
          <img
            src="assets/images/ui/logo_title_with_cockroach.png"
            alt="Cockroach Run"
            class="game-logo"
          />
        </div>
        <div class="menu-buttons">
          <button id="play-button" class="menu-button">PLAY</button>
          <button id="settings-button" class="menu-button">SETTINGS</button>
          <button id="connect-wallet-button" class="menu-button">CONNECT WALLET</button>
        </div>
        <div class="version-info">v0.1.0 Beta â€¢ Bitcoin Integration</div>
      </div>
    </div>

    <!-- Mode Selection Screen -->
    <div id="mode-selection-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">SELECT MODE</h2>
        <div class="mode-selection">
          <div class="mode-card" data-mode="free-world">
            <div class="mode-image">
              <div class="kitchen-environment"></div>
            </div>

            <h3>FREE WORLD</h3>
            <p>Explore different environments at your own pace</p>
          </div>
          <div class="mode-card" data-mode="cockroach-runner">
            <div class="mode-image">
              <div class="runner-environment"></div>
            </div>

            <h3>COCKROACH RUNNER</h3>
            <p>Race through endless obstacles, collect resources</p>
          </div>
        </div>
        <button id="back-from-mode" class="back-button">BACK</button>
      </div>
    </div>

    <!-- Character Selection Screen -->
    <div id="character-selection-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">SELECT COCKROACH</h2>

        <div class="carousel-container">
          <div class="carousel-wrapper">
            <!-- Hardcoded first character to ensure it displays properly -->
            <!-- The JavaScript will handle switching among multiple characters -->
            <!-- Navigation arrows -->
            <button class="carousel-arrow carousel-prev" title="Previous" role="button" aria-label="Previous Slide" tabindex="0">&lt;</button>
            <button class="carousel-arrow carousel-next" title="Next" role="button" aria-label="Next Slide" tabindex="0">&gt;</button>
          </div>
        </div>

        <!-- Indicator dots -->
        <div id="carousel-indicators" class="carousel-indicators">
            <div class="carousel-dot active" data-index="0"></div>
            <div class="carousel-dot" data-index="1"></div>
            <div class="carousel-dot" data-index="2"></div>
        </div>

        <div class="button-stack">
          <button id="start-game-button" class="start-button">START GAME</button>
          <button id="back-from-character" class="back-button">BACK</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Make sure we have the right number of indicator dots
    document.addEventListener('DOMContentLoaded', function() {
      const indicators = document.getElementById('carousel-indicators');
      const characterCount = 3; // Based on your character count
  
      // Clear and rebuild indicators if needed
      if (indicators && indicators.children.length !== characterCount) {
        indicators.innerHTML = '';
        for (let i = 0; i < characterCount; i++) {
          const dot = document.createElement('div');
          dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
          dot.setAttribute('data-index', i);
          dot.addEventListener('click', function() {
            // This will be handled by your existing click handler
          });
          indicators.appendChild(dot);
        }
      }
    });
</script>

    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">SETTINGS</h2>
        <div class="settings-content">
          <div class="settings-section">
            <h3>AUDIO</h3>
            <div class="setting-item">
              <span>Music Volume</span>
              <div class="slider-container">
                <input
                  type="range"
                  id="music-volume"
                  min="0"
                  max="100"
                  value="80"
                  class="slider"
                />
                <span class="slider-value">80%</span>
              </div>

            </div>

<div class="setting-item">
              <span>Sound Effects</span>
              <div class="slider-container">
                <input
                  type="range"
                  id="sfx-volume"
                  min="0"
                  max="100"
                  value="100"
                  class="slider"
                />
                <span class="slider-value">100%</span>
              </div>

            </div>

            <div class="setting-item">
              <span id="music-track-label">Music Track</span> <!-- Added ID for accessibility -->
              <!-- Custom Dropdown Wrapper -->
              <div class="custom-dropdown-wrapper" data-target-select="music-select">
                <!-- Hidden original select for functionality -->
                <select id="music-select" class="original-select" aria-hidden="true" tabindex="-1">
                  <option value="checkpoint-chaser" selected>Checkpoint Chaser</option>
                  <option value="cockroach-comeback">Cockroach Comeback</option>
                  <option value="cockroach-run">Cockroach Run</option>
                  <option value="dodge-weave-waltz">Dodge and Weave Waltz</option>
                  <option value="egg-checkpoint-blues">Egg Checkpoint Blues</option>
                  <option value="egg-layers-lament">Egg-Layer's Lament</option>
                  <option value="evolutions-edge">Evolution's Edge</option>
                  <option value="futuristic-flee">Futuristic Flee</option>
                  <option value="gliders-getaway">Glider's Getaway</option>
                  <option value="human-threat-harmony">Human Threat Harmony</option>
                  <option value="neon-roach-runnin">Neon Roach Runnin</option>
                  <option value="night-cycle-nomad">Night Cycle Nomad</option>
                  <option value="obstacle-dodge-dance">Obstacle Dodge Dance</option>
                  <option value="roach-on-the-run">Roach on the Run</option>
                  <option value="run-roach-run">Run, Roach, Run!</option>
                  <option value="scurry-in-the-shadows">Scurry in the Shadows</option>
                  <option value="sewer-sirens-call">Sewer Siren's Call</option>
                  <option value="sewer-survivors-sound">Sewer Survivor's Sound</option>
                  <option value="skittering-skyline">Skittering Skyline</option>
                  <option value="urban-jungle-jive">Urban Jungle Jive</option>
                  <option value="urban-odyssey-overture">Urban Odyssey Overture</option>
                </select>
                <!-- Visible custom dropdown trigger -->
                <div class="custom-dropdown-trigger" role="combobox" aria-haspopup="listbox" aria-expanded="false" aria-labelledby="music-track-label selected-music-text" tabindex="0">
                   <span class="selected-option-text" id="selected-music-text">Checkpoint Chaser</span> <!-- JS will update this text -->
                </div>
                <!-- Custom options list (styled and controlled by JS) -->
                <ul class="custom-options-list" role="listbox" aria-labelledby="music-track-label" hidden>
                  <li class="custom-option" data-value="checkpoint-chaser" role="option" tabindex="-1">Checkpoint Chaser</li>
                  <li class="custom-option" data-value="cockroach-comeback" role="option" tabindex="-1">Cockroach Comeback</li>
                  <li class="custom-option" data-value="cockroach-run" role="option" tabindex="-1">Cockroach Run</li>
                  <li class="custom-option" data-value="dodge-weave-waltz" role="option" tabindex="-1">Dodge and Weave Waltz</li>
                  <li class="custom-option" data-value="egg-checkpoint-blues" role="option" tabindex="-1">Egg Checkpoint Blues</li>
                  <li class="custom-option" data-value="egg-layers-lament" role="option" tabindex="-1">Egg-Layer's Lament</li>
                  <li class="custom-option" data-value="evolutions-edge" role="option" tabindex="-1">Evolution's Edge</li>
                  <li class="custom-option" data-value="futuristic-flee" role="option" tabindex="-1">Futuristic Flee</li>
                  <li class="custom-option" data-value="gliders-getaway" role="option" tabindex="-1">Glider's Getaway</li>
                  <li class="custom-option" data-value="human-threat-harmony" role="option" tabindex="-1">Human Threat Harmony</li>
                  <li class="custom-option" data-value="neon-roach-runnin" role="option" tabindex="-1">Neon Roach Runnin</li>
                  <li class="custom-option" data-value="night-cycle-nomad" role="option" tabindex="-1">Night Cycle Nomad</li>
                  <li class="custom-option" data-value="obstacle-dodge-dance" role="option" tabindex="-1">Obstacle Dodge Dance</li>
                  <li class="custom-option" data-value="roach-on-the-run" role="option" tabindex="-1">Roach on the Run</li>
                  <li class="custom-option" data-value="run-roach-run" role="option" tabindex="-1">Run, Roach, Run!</li>
                  <li class="custom-option" data-value="scurry-in-the-shadows" role="option" tabindex="-1">Scurry in the Shadows</li>
                  <li class="custom-option" data-value="sewer-sirens-call" role="option" tabindex="-1">Sewer Siren's Call</li>
                  <li class="custom-option" data-value="sewer-survivors-sound" role="option" tabindex="-1">Sewer Survivor's Sound</li>
                  <li class="custom-option" data-value="skittering-skyline" role="option" tabindex="-1">Skittering Skyline</li>
                  <li class="custom-option" data-value="urban-jungle-jive" role="option" tabindex="-1">Urban Jungle Jive</li>
                  <li class="custom-option" data-value="urban-odyssey-overture" role="option" tabindex="-1">Urban Odyssey Overture</li>
                </ul>
              </div>
            </div>

            <!-- Music Playback Mode Controls -->
            <div class="setting-item">
              <span>Playback Mode</span>
              <div class="playback-controls">
                <button id="single-mode-btn" class="mode-btn active" title="Play Single Track" onclick="AudioManager.setPlaybackMode('single')">
                  <i class="fas fa-music"></i> One
                </button>
                <button id="sequential-mode-btn" class="mode-btn" title="Play All Tracks Sequentially" onclick="AudioManager.setPlaybackMode('sequential')">
                  <i class="fas fa-list"></i> All
                </button>
                <button id="random-mode-btn" class="mode-btn" title="Play Random Tracks" onclick="AudioManager.setPlaybackMode('random')">
                  <i class="fas fa-random"></i> Mix
                </button>
              </div>
            </div>
            
            <div class="setting-item">
              <label for="mute-toggle">Mute All Sound</label>
              <button id="mute-toggle" class="toggle-button"> 
                <span class="toggle-indicator"></span>
              </button>
            </div>

          </div>
          <div class="settings-section">
            <h3>GRAPHICS</h3>
            <div class="setting-item">
              <span id="quality-label">Quality</span> <!-- Added ID -->
              <!-- Custom Dropdown Wrapper -->
              <div class="custom-dropdown-wrapper" data-target-select="quality-select">
                 <!-- Hidden original select -->
                 <select id="quality-select" class="original-select" aria-hidden="true" tabindex="-1">
                   <option value="low">LOW</option>
                   <option value="medium" selected>MEDIUM</option>
                   <option value="high">HIGH</option>
                 </select>
                 <!-- Visible custom dropdown trigger -->
                 <div class="custom-dropdown-trigger" role="combobox" aria-haspopup="listbox" aria-expanded="false" aria-labelledby="quality-label selected-quality-text" tabindex="0">
                    <span class="selected-option-text" id="selected-quality-text">MEDIUM</span> <!-- JS updates this -->
                 </div>
                 <!-- Custom options list -->
                 <ul class="custom-options-list" role="listbox" aria-labelledby="quality-label" hidden>
                   <li class="custom-option" data-value="low" role="option" tabindex="-1">LOW</li>
                   <li class="custom-option" data-value="medium" role="option" tabindex="-1">MEDIUM</li>
                   <li class="custom-option" data-value="high" role="option" tabindex="-1">HIGH</li>
                 </ul>
              </div>
            </div>

            <div class="setting-item">
              <span>Show FPS</span>
              <div class="toggle-container">
                <button id="fps-toggle" class="toggle-button">
                  <span class="toggle-indicator"></span>
                </button>
              </div>

            </div>


          </div>
          <!-- Player section removed -->
          <div class="settings-section">
            <h3>ABOUT</h3>
            <div class="setting-item">
              <button id="credits-button" class="menu-button">CREDITS</button>
            </div>
          </div>
          <div class="button-row">
            <button id="back-from-settings" class="back-button">BACK</button>
            <button id="save-settings" class="save-button">SAVE</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Credits Screen -->
    <div id="credits-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">CREDITS</h2>
        <div class="credits-content">
          <div class="credits-section">
            <h3>GAME DESIGN</h3>
            <p>Cockroach Run Team</p>
          </div>
          <div class="credits-section">
            <h3>DEVELOPMENT</h3>
            <p>Cockroach Run Team</p>
          </div>
          <div class="credits-section">
            <h3>3D MODELS</h3>
            <p>Created using Meshy.ai and Blender</p>
          </div>
          <div class="credits-section">
            <h3>SPECIAL THANKS</h3>
            <p>The Three.js Community</p>
            <p>All Our Supporters</p>
          </div>
        </div>
        <button id="back-from-credits" class="back-button">BACK</button>
      </div>
    </div>

    <!-- Pause Screen -->
    <div id="pause-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">PAUSED</h2>
        <div class="menu-buttons">
          <button id="resume-button" class="menu-button">RESUME</button>
          <button id="restart-button" class="menu-button">RESTART</button>
          <button id="quit-button" class="menu-button">QUIT</button>
        </div>
      </div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen" class="screen">
      <div class="menu-container">
        <h2 class="screen-title">GAME OVER</h2>
        <div class="score-display">
          <div class="score-row">
            <span>SCORE:</span>
            <span id="final-score">0</span>
          </div>
          <div class="score-row">
            <span>HIGH SCORE:</span>
            <span id="high-score">0</span>
          </div>
        </div>
        <div class="menu-buttons">
          <button id="try-again-button" class="menu-button">TRY AGAIN</button>
          <button id="main-menu-button" class="menu-button">MAIN MENU</button>
        </div>
      </div>
    </div>

    <!-- Game HUD -->
    <div id="game-hud" class="hidden">
      <div id="score-display">
        <span>SCORE:</span>
        <span id="score-value">0</span>
      </div>
      <div id="health-container">
        <div id="health-bar"></div>
      </div>
      <button id="pause-button" class="pause-button">II</button>
    </div>
  </div>

  <!-- Audio Elements -->
  <audio id="menu-music" loop preload="auto">
    <source src="assets/sounds/music/Menu_loop.mp3" type="audio/mpeg" />
  </audio>
  <audio id="game-music" loop preload="auto">
    <source src="assets/sounds/music/Cockroach run music.mp3" type="audio/mpeg" />
  </audio>
  <audio id="button-click" preload="auto">
    <source src="assets/sounds/sfx/button_click.wav" type="audio/wav" />
  </audio>
  <audio id="scatter-sound" preload="auto">
    <source src="assets/sounds/sfx/scatter.wav" type="audio/wav" />
  </audio>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.144.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.144.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="js/config.js"></script>
  <script src="js/DropdownSystem.js"></script>
  <script src="js/audio.js" defer></script>
  <script src="js/ui.js" defer></script>
  <script src="js/characterCarousel.js"></script>
  <script src="js/main.js" defer></script>
  <script src="js/soundEffects.js"></script>
  <script src="js/smoothLoading.js"></script>
  <script src="js/fixCardTransition.js"></script>
  <script src="js/fixEventBugs.js"></script>
  <!-- Bitcoin Wallet Integration -->
  <script src="js/services/wallet.js"></script>
  <!-- Game State Management -->
  <script src="js/core/gameStateManager.js"></script>
</body>
</html>
