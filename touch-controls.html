<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cockroach Run - Touch Controls</title>
  <!-- Load Three.js libraries -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cannon@0.6.2/build/cannon.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #121212;
      color: #00FF66;
      font-family: monospace;
    }
    
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    
    #touch-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 100;
    }
    
    .control-row {
      display: flex;
      margin: 5px 0;
    }
    
    .control-btn {
      width: 60px;
      height: 60px;
      background-color: rgba(0, 0, 0, 0.5);
      border: 2px solid #9333EA;
      color: #00FF66;
      font-size: 24px;
      margin: 0 5px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
    
    .control-btn:active {
      background-color: #9333EA;
      color: white;
    }
    
    #info-panel {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
      max-width: 300px;
      z-index: 100;
    }
    
    #debug-info {
      position: absolute;
      bottom: 200px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      max-height: 100px;
      overflow-y: auto;
      width: 300px;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="game-canvas"></canvas>
    
    <!-- On-screen touch controls -->
    <div id="touch-controls">
      <div class="control-row">
        <div class="control-btn" id="btn-forward">↑</div>
      </div>
      <div class="control-row">
        <div class="control-btn" id="btn-left">←</div>
        <div class="control-btn" id="btn-jump">⬤</div>
        <div class="control-btn" id="btn-right">→</div>
      </div>
      <div class="control-row">
        <div class="control-btn" id="btn-backward">↓</div>
      </div>
    </div>
    
    <div id="info-panel">
      <h3>Cockroach Run</h3>
      <p>Use the on-screen buttons to control the cockroach:</p>
      <p>↑: Move Forward</p>
      <p>↓: Move Backward</p>
      <p>←: Rotate Left</p>
      <p>→: Rotate Right</p>
      <p>⬤: Jump</p>
    </div>
    
    <div id="debug-info">
      Initializing game...
    </div>
  </div>
  
  <script>
    // Debug logging
    const debugInfo = document.getElementById('debug-info');
    
    function log(message) {
      console.log(message);
      if (debugInfo) {
        debugInfo.innerHTML += message + '<br>';
        debugInfo.scrollTop = debugInfo.scrollHeight;
      }
    }
    
    // Game variables
    let scene, camera, renderer;
    let physicsWorld;
    let cockroachModel, cockroachBody;
    let clock;
    let isRunning = false;
    
    // Input state
    const keys = {
      forward: false,
      backward: false,
      left: false,
      right: false,
      jump: false
    };
    
    // Initialize game
    function init() {
      log('Initializing game...');
      
      try {
        // Get canvas
        const canvas = document.getElementById('game-canvas');
        
        // Create renderer
        renderer = new THREE.WebGLRenderer({
          canvas: canvas,
          antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        
        // Create scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x121212);
        
        // Create camera
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);
        
        // Create clock
        clock = new THREE.Clock();
        
        // Initialize physics
        initPhysics();
        
        // Create environment
        createEnvironment();
        
        // Create cockroach
        createCockroach();
        
        // Setup touch controls
        setupTouchControls();
        
        // Handle window resize
        window.addEventListener('resize', function() {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Start game loop
        isRunning = true;
        animate();
        
        log('Game initialized successfully!');
        return true;
      } catch (error) {
        log('Error initializing game: ' + error.message);
        return false;
      }
    }
    
    // Initialize physics
    function initPhysics() {
      log('Initializing physics...');
      
      physicsWorld = new CANNON.World();
      physicsWorld.gravity.set(0, -9.82, 0);
      physicsWorld.broadphase = new CANNON.NaiveBroadphase();
      physicsWorld.solver.iterations = 10;
      
      // Ground plane
      const groundShape = new CANNON.Plane();
      const groundBody = new CANNON.Body({ mass: 0 });
      groundBody.addShape(groundShape);
      groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
      physicsWorld.addBody(groundBody);
    }
    
    // Create environment
    function createEnvironment() {
      log('Creating environment...');
      
      // Lights
      const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(10, 20, 15);
      directionalLight.castShadow = true;
      scene.add(directionalLight);
      
      // Cyberpunk lights
      const purpleLight = new THREE.PointLight(0x9333EA, 1, 50);
      purpleLight.position.set(5, 5, 5);
      scene.add(purpleLight);
      
      const greenLight = new THREE.PointLight(0x00FF66, 1, 50);
      greenLight.position.set(-5, 3, -5);
      scene.add(greenLight);
      
      // Ground
      const groundGeometry = new THREE.PlaneGeometry(100, 100);
      const groundMaterial = new THREE.MeshStandardMaterial({
        color: 0x333333,
        roughness: 0.8,
        metalness: 0.2
      });
      const ground = new THREE.Mesh(groundGeometry, groundMaterial);
      ground.rotation.x = -Math.PI / 2;
      ground.receiveShadow = true;
      scene.add(ground);
      
      // Grid
      const gridHelper = new THREE.GridHelper(100, 100, 0x00FF66, 0x444444);
      scene.add(gridHelper);
      
      // Obstacles
      createObstacle(5, 1, 5, 0x9333EA);
      createObstacle(-5, 1, -5, 0x00FF66);
      createObstacle(5, 1, -5, 0x9333EA);
      createObstacle(-5, 1, 5, 0x00FF66);
    }
    
    // Create an obstacle
    function createObstacle(x, y, z, color) {
      // Visual
      const geometry = new THREE.BoxGeometry(2, 2, 2);
      const material = new THREE.MeshStandardMaterial({ color: color });
      const obstacle = new THREE.Mesh(geometry, material);
      obstacle.position.set(x, y, z);
      obstacle.castShadow = true;
      scene.add(obstacle);
      
      // Physics
      const shape = new CANNON.Box(new CANNON.Vec3(1, 1, 1));
      const body = new CANNON.Body({ mass: 0 });
      body.addShape(shape);
      body.position.set(x, y, z);
      physicsWorld.addBody(body);
    }
    
    // Create cockroach
    function createCockroach() {
      log('Creating cockroach...');
      
      // Placeholder box
      const geometry = new THREE.BoxGeometry(1, 0.5, 2);
      const material = new THREE.MeshStandardMaterial({ color: 0xaa5500 });
      cockroachModel = new THREE.Mesh(geometry, material);
      cockroachModel.position.set(0, 1, 0);
      cockroachModel.castShadow = true;
      scene.add(cockroachModel);
      
      // Physics body
      const shape = new CANNON.Box(new CANNON.Vec3(0.5, 0.25, 1));
      cockroachBody = new CANNON.Body({ mass: 1 });
      cockroachBody.addShape(shape);
      cockroachBody.position.set(0, 1, 0);
      physicsWorld.addBody(cockroachBody);
    }
    
    // Setup touch controls
    function setupTouchControls() {
      log('Setting up touch controls...');
      
      // Get buttons
      const btnForward = document.getElementById('btn-forward');
      const btnBackward = document.getElementById('btn-backward');
      const btnLeft = document.getElementById('btn-left');
      const btnRight = document.getElementById('btn-right');
      const btnJump = document.getElementById('btn-jump');
      
      // Forward button
      btnForward.addEventListener('mousedown', function() {
        keys.forward = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Forward pressed');
      });
      
      btnForward.addEventListener('mouseup', function() {
        keys.forward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      btnForward.addEventListener('mouseleave', function() {
        keys.forward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Touch events for forward
      btnForward.addEventListener('touchstart', function(e) {
        e.preventDefault();
        keys.forward = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Forward touched');
      });
      
      btnForward.addEventListener('touchend', function(e) {
        e.preventDefault();
        keys.forward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Backward button
      btnBackward.addEventListener('mousedown', function() {
        keys.backward = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Backward pressed');
      });
      
      btnBackward.addEventListener('mouseup', function() {
        keys.backward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      btnBackward.addEventListener('mouseleave', function() {
        keys.backward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Touch events for backward
      btnBackward.addEventListener('touchstart', function(e) {
        e.preventDefault();
        keys.backward = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
      });
      
      btnBackward.addEventListener('touchend', function(e) {
        e.preventDefault();
        keys.backward = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Left button
      btnLeft.addEventListener('mousedown', function() {
        keys.left = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Left pressed');
      });
      
      btnLeft.addEventListener('mouseup', function() {
        keys.left = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      btnLeft.addEventListener('mouseleave', function() {
        keys.left = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Touch events for left
      btnLeft.addEventListener('touchstart', function(e) {
        e.preventDefault();
        keys.left = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
      });
      
      btnLeft.addEventListener('touchend', function(e) {
        e.preventDefault();
        keys.left = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Right button
      btnRight.addEventListener('mousedown', function() {
        keys.right = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Right pressed');
      });
      
      btnRight.addEventListener('mouseup', function() {
        keys.right = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      btnRight.addEventListener('mouseleave', function() {
        keys.right = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Touch events for right
      btnRight.addEventListener('touchstart', function(e) {
        e.preventDefault();
        keys.right = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
      });
      
      btnRight.addEventListener('touchend', function(e) {
        e.preventDefault();
        keys.right = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Jump button
      btnJump.addEventListener('mousedown', function() {
        keys.jump = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
        log('Jump pressed');
      });
      
      btnJump.addEventListener('mouseup', function() {
        keys.jump = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      btnJump.addEventListener('mouseleave', function() {
        keys.jump = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
      
      // Touch events for jump
      btnJump.addEventListener('touchstart', function(e) {
        e.preventDefault();
        keys.jump = true;
        this.style.backgroundColor = '#9333EA';
        this.style.color = 'white';
      });
      
      btnJump.addEventListener('touchend', function(e) {
        e.preventDefault();
        keys.jump = false;
        this.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        this.style.color = '#00FF66';
      });
    }
    
    // Update cockroach movement based on inputs
    function updateCockroach() {
      if (!cockroachBody || !cockroachModel) return;
      
      // Movement parameters
      const force = 10;
      const torque = 5;
      
      // Apply forces based on input
      if (keys.forward) {
        cockroachBody.applyLocalForce(new CANNON.Vec3(0, 0, -force), new CANNON.Vec3(0, 0, 0));
      }
      if (keys.backward) {
        cockroachBody.applyLocalForce(new CANNON.Vec3(0, 0, force), new CANNON.Vec3(0, 0, 0));
      }
      if (keys.left) {
        cockroachBody.applyTorque(new CANNON.Vec3(0, torque, 0));
      }
      if (keys.right) {
        cockroachBody.applyTorque(new CANNON.Vec3(0, -torque, 0));
      }
      if (keys.jump && cockroachBody.position.y < 1.1) {
        cockroachBody.applyImpulse(new CANNON.Vec3(0, 5, 0), cockroachBody.position);
      }
      
      // Update visual model position
      cockroachModel.position.copy(cockroachBody.position);
      cockroachModel.quaternion.copy(cockroachBody.quaternion);
    }
    
    // Update camera to follow cockroach
    function updateCamera() {
      if (!cockroachModel || !camera) return;
      
      // Third-person camera offset
      const offset = new THREE.Vector3(0, 3, 6);
      offset.applyQuaternion(cockroachModel.quaternion);
      
      // Position camera
      const targetPosition = new THREE.Vector3()
        .copy(cockroachModel.position)
        .add(offset);
      
      camera.position.copy(targetPosition);
      camera.lookAt(cockroachModel.position);
    }
    
    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      
      if (!isRunning) return;
      
      // Get delta time
      const delta = clock.getDelta();
      
      // Update physics
      if (physicsWorld) {
        physicsWorld.step(1/60, delta, 3);
      }
      
      // Update cockroach
      updateCockroach();
      
      // Update camera
      updateCamera();
      
      // Render scene
      if (renderer && scene && camera) {
        renderer.render(scene, camera);
      }
    }
    
    // Start the game
    init();
  </script>
</body>
</html>
