<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standalone Cockroach Control Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #121212;
            color: #00FF66;
            font-family: monospace;
        }
        
        #debug-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00FF66;
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
            z-index: 100;
        }
        
        #key-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 10px;
        }
        
        .key-row {
            display: flex;
        }
        
        .key {
            width: 40px;
            height: 40px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid #9333EA;
            color: #00FF66;
            border-radius: 5px;
        }
        
        .key.active {
            background-color: #9333EA;
            color: white;
        }
        
        #focus-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        button {
            background-color: #9333EA;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="focus-overlay">
        <h2 style="color: #00FF66;">Click the button to start</h2>
        <p style="color: #00FF66; text-align: center; max-width: 400px;">
            This is a minimal test to ensure keyboard controls work.
            <br>Use WASD or arrow keys to move the cockroach.
        </p>
        <button id="start-button">START</button>
    </div>
    
    <div id="debug-panel">
        <h3>Key States:</h3>
        <div id="key-states">No keys pressed yet</div>
        <div id="position-display">Position: X=0, Y=0, Z=0</div>
        <div id="key-display">
            <div class="key-row">
                <div class="key" id="key-w">W</div>
            </div>
            <div class="key-row">
                <div class="key" id="key-a">A</div>
                <div class="key" id="key-s">S</div>
                <div class="key" id="key-d">D</div>
            </div>
            <div class="key-row">
                <div class="key" id="key-space">SPC</div>
            </div>
        </div>
    </div>
    
    <canvas id="canvas"></canvas>
    
    <script>
        // DOM elements
        const canvas = document.getElementById('canvas');
        const focusOverlay = document.getElementById('focus-overlay');
        const startButton = document.getElementById('start-button');
        const keyStates = document.getElementById('key-states');
        const positionDisplay = document.getElementById('position-display');
        
        // Key display elements
        const keyW = document.getElementById('key-w');
        const keyA = document.getElementById('key-a');
        const keyS = document.getElementById('key-s');
        const keyD = document.getElementById('key-d');
        const keySpace = document.getElementById('key-space');
        
        // Set the canvas to fill the window
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const ctx = canvas.getContext('2d');
        
        // Game state
        let keys = {
            forward: false,
            backward: false,
            left: false,
            right: false,
            jump: false
        };
        
        let cockroach = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            rotation: 0,
            size: 30,
            speed: 5,
            rotationSpeed: 0.1,
            isJumping: false,
            jumpHeight: 0
        };
        
        // Grid parameters
        const gridSize = 50;
        const gridColor = '#00FF66';
        
        // Start button click
        startButton.addEventListener('click', function() {
            focusOverlay.style.display = 'none';
            canvas.focus();
            console.log('Game started and focused!');
        });
        
        // Key event handlers
        document.addEventListener('keydown', function(e) {
            console.log('Key down:', e.key, 'Code:', e.code);
            
            const key = e.key.toLowerCase();
            const code = e.code;
            
            if (key === 'w' || key === 'arrowup' || code === 'KeyW' || code === 'ArrowUp') {
                keys.forward = true;
            }
            if (key === 's' || key === 'arrowdown' || code === 'KeyS' || code === 'ArrowDown') {
                keys.backward = true;
            }
            if (key === 'a' || key === 'arrowleft' || code === 'KeyA' || code === 'ArrowLeft') {
                keys.left = true;
            }
            if (key === 'd' || key === 'arrowright' || code === 'KeyD' || code === 'ArrowRight') {
                keys.right = true;
            }
            if (key === ' ' || code === 'Space') {
                keys.jump = true;
            }
            
            updateKeyDisplay();
        });
        
        document.addEventListener('keyup', function(e) {
            const key = e.key.toLowerCase();
            const code = e.code;
            
            if (key === 'w' || key === 'arrowup' || code === 'KeyW' || code === 'ArrowUp') {
                keys.forward = false;
            }
            if (key === 's' || key === 'arrowdown' || code === 'KeyS' || code === 'ArrowDown') {
                keys.backward = false;
            }
            if (key === 'a' || key === 'arrowleft' || code === 'KeyA' || code === 'ArrowLeft') {
                keys.left = false;
            }
            if (key === 'd' || key === 'arrowright' || code === 'KeyD' || code === 'ArrowRight') {
                keys.right = false;
            }
            if (key === ' ' || code === 'Space') {
                keys.jump = false;
            }
            
            updateKeyDisplay();
        });
        
        // Update key display in the UI
        function updateKeyDisplay() {
            // Update text display
            keyStates.innerHTML = `
                Forward: ${keys.forward ? 'YES' : 'no'}<br>
                Backward: ${keys.backward ? 'YES' : 'no'}<br>
                Left: ${keys.left ? 'YES' : 'no'}<br>
                Right: ${keys.right ? 'YES' : 'no'}<br>
                Jump: ${keys.jump ? 'YES' : 'no'}
            `;
            
            // Update key visuals
            keyW.classList.toggle('active', keys.forward);
            keyS.classList.toggle('active', keys.backward);
            keyA.classList.toggle('active', keys.left);
            keyD.classList.toggle('active', keys.right);
            keySpace.classList.toggle('active', keys.jump);
            
            // Log for debugging
            console.log(`Keys: F=${keys.forward}, B=${keys.backward}, L=${keys.left}, R=${keys.right}, J=${keys.jump}`);
        }
        
        // Handle movement updates
        function updateCockroach() {
            // Handle rotation
            if (keys.left) {
                cockroach.rotation -= cockroach.rotationSpeed;
            }
            if (keys.right) {
                cockroach.rotation += cockroach.rotationSpeed;
            }
            
            // Calculate direction vector based on rotation
            const dx = Math.sin(cockroach.rotation) * cockroach.speed;
            const dy = -Math.cos(cockroach.rotation) * cockroach.speed;
            
            // Handle movement
            if (keys.forward) {
                cockroach.x += dx;
                cockroach.y += dy;
            }
            if (keys.backward) {
                cockroach.x -= dx;
                cockroach.y -= dy;
            }
            
            // Keep cockroach within bounds
            if (cockroach.x < 0) cockroach.x = 0;
            if (cockroach.x > canvas.width) cockroach.x = canvas.width;
            if (cockroach.y < 0) cockroach.y = 0;
            if (cockroach.y > canvas.height) cockroach.y = canvas.height;
            
            // Handle jumping
            if (keys.jump && !cockroach.isJumping) {
                cockroach.isJumping = true;
                cockroach.jumpHeight = 0;
            }
            
            if (cockroach.isJumping) {
                cockroach.jumpHeight += 0.1;
                if (cockroach.jumpHeight >= Math.PI) {
                    cockroach.isJumping = false;
                    cockroach.jumpHeight = 0;
                }
            }
            
            // Update position display
            positionDisplay.innerHTML = `Position: X=${Math.round(cockroach.x)}, Y=${Math.round(cockroach.y)}, Rotation=${Math.round(cockroach.rotation * 180 / Math.PI)}Â°`;
        }
        
        // Draw functions
        function drawGrid() {
            ctx.strokeStyle = gridColor;
            ctx.globalAlpha = 0.2;
            
            // Draw vertical lines
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Draw horizontal lines
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawCockroach() {
            ctx.save();
            
            // Translate to cockroach position
            ctx.translate(cockroach.x, cockroach.y);
            
            // Apply jump effect
            const jumpOffset = cockroach.isJumping ? Math.sin(cockroach.jumpHeight) * 50 : 0;
            ctx.translate(0, -jumpOffset);
            
            // Rotate cockroach
            ctx.rotate(cockroach.rotation);
            
            // Draw cockroach body (oval)
            ctx.fillStyle = '#aa5500';
            ctx.beginPath();
            ctx.ellipse(0, 0, cockroach.size, cockroach.size / 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw cockroach head
            ctx.fillStyle = '#884400';
            ctx.beginPath();
            ctx.ellipse(cockroach.size / 2, 0, cockroach.size / 4, cockroach.size / 6, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw cockroach legs
            ctx.strokeStyle = '#884400';
            ctx.lineWidth = 2;
            
            // Draw 3 legs on each side
            for (let i = -1; i <= 1; i++) {
                // Left legs
                ctx.beginPath();
                ctx.moveTo(-cockroach.size / 4, i * (cockroach.size / 4));
                ctx.lineTo(-cockroach.size, i * (cockroach.size / 3));
                ctx.stroke();
                
                // Right legs
                ctx.beginPath();
                ctx.moveTo(cockroach.size / 4, i * (cockroach.size / 4));
                ctx.lineTo(cockroach.size, i * (cockroach.size / 3));
                ctx.stroke();
            }
            
            // Draw antennae
            ctx.beginPath();
            ctx.moveTo(cockroach.size / 2, -cockroach.size / 6);
            ctx.lineTo(cockroach.size, -cockroach.size / 3);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(cockroach.size / 2, cockroach.size / 6);
            ctx.lineTo(cockroach.size, cockroach.size / 3);
            ctx.stroke();
            
            ctx.restore();
        }
        
        // Main game loop
        function gameLoop() {
            // Clear canvas
            ctx.fillStyle = '#121212';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            drawGrid();
            
            // Update cockroach
            updateCockroach();
            
            // Draw cockroach
            drawCockroach();
            
            // Request next frame
            requestAnimationFrame(gameLoop);
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Center cockroach if it's off-screen after resize
            if (cockroach.x > canvas.width) cockroach.x = canvas.width / 2;
            if (cockroach.y > canvas.height) cockroach.y = canvas.height / 2;
        });
        
        // Start game loop
        gameLoop();
        
        // Auto-focus for testing (comment this out for production)
        //focusOverlay.style.display = 'none';
    </script>
</body>
</html>
