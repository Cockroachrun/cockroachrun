<script>
(function() {
  const iframe = document.querySelector("iframe");
  const iframeWindow = iframe.contentWindow;
  const gameMode = iframeWindow.game.activeGameMode;

  // Add zoomLevel property
  gameMode.zoomLevel = 1;
  const MIN_ZOOM = 0.5;
  const MAX_ZOOM = 2;
  
  // Wheel event handler
  function handleWheel(event) {
    event.preventDefault();
    const delta = event.deltaY * -0.001;
    gameMode.zoomLevel = Math.max(MIN_ZOOM, Math.min(gameMode.zoomLevel + delta, MAX_ZOOM));
  }

  // Add wheel event listener to iframe document
  iframe.contentDocument.addEventListener("wheel", handleWheel);

  // Update camera function
  gameMode.updateCamera = function() {
    if (this.debugMode) return;

    const model = this.isModelLoaded ? this.cockroachModel : this.placeholder;
    if (!model) return;

    const offset = this.cameraOffset.clone();
    offset.multiplyScalar(this.zoomLevel);
    offset.applyAxisAngle(new THREE.Vector3(0, 1, 0), model.rotation.y);

    const cameraPosition = model.position.clone().add(offset);
    this.camera.position.copy(cameraPosition);
    this.camera.lookAt(model.position);
  };

  // Zoom button event handlers
  const zoomInButton = iframe.contentDocument.getElementById("zoom-in-button");
  const zoomOutButton = iframe.contentDocument.getElementById("zoom-out-button");

  zoomInButton.addEventListener("click", function() {
    gameMode.zoomLevel = Math.min(gameMode.zoomLevel + 0.1, MAX_ZOOM);
  });

  zoomOutButton.addEventListener("click", function() {
    gameMode.zoomLevel = Math.max(gameMode.zoomLevel - 0.1, MIN_ZOOM);
  });
})();
</script>
